<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Matside — Upcoming Matches By Mat</title>

<!-- THEMES -->
<link rel="stylesheet" href="./css/theme.css" />
<link rel="stylesheet" href="./css/overview.css" />

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore-compat.js"></script>

<style>
/* FORCE DARK TEXT (override theme.css / overview.css) */
body, h1, h2, h3, div, span, p {
  color: #222 !important;
}

body {
  background: #f5f5f5;
  font-family: Arial, sans-serif;
  padding: 20px;
}

#upcoming-root {
  max-width: 1600px;
  margin: 0 auto;
}

h1 {
  margin-bottom: 20px;
  font-size: 28px;
  font-weight: 700;
}

/* Grid for mats */
.mat-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 20px;
}

/* Card */
.mat-card {
  background: white;
  border-radius: 10px;
  padding: 16px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.12);
}

/* Section headers */
.mat-card h2 {
  font-size: 22px;
  margin-bottom: 16px;
  text-align: center;
  border-bottom: 2px solid #ddd;
  padding-bottom: 10px;
}

/* Tier titles */
.tier-title {
  font-weight: bold;
  font-size: 16px;
  margin-top: 10px;
  padding-bottom: 4px;
  border-bottom: 1px solid #ccc;
}

/* Match item */
.match-item {
  padding: 10px;
  border-bottom: 1px solid #eee;
  font-size: 14px;
  line-height: 1.3;
}

.match-item:last-child {
  border-bottom: none;
}

.match-meta {
  font-size: 12px;
  color: #555;
  margin-top: 4px;
}

/* Empty state */
.empty-text {
  color: #888;
  margin: 10px 0 20px;
  font-size: 14px;
  font-style: italic;
}

/* Highlight tiers */
.now-wrestling {
  background: #ffe0e0;
  border-left: 4px solid #d40000;
  border-radius: 4px;
}

.on-deck {
  background: #e8f3ff;
  border-left: 4px solid #0066c8;
  border-radius: 4px;
}

.in-hole {
  background: #fff7e0;
  border-left: 4px solid #cc9200;
  border-radius: 4px;
}

</style>
</head>

<body>

<div id="upcoming-root">
  <h1>Matside — Upcoming Matches by Mat</h1>

  <div class="mat-grid">
    <div class="mat-card"><h2>Mat 1</h2><div id="mat-1"></div></div>
    <div class="mat-card"><h2>Mat 2</h2><div id="mat-2"></div></div>
    <div class="mat-card"><h2>Mat 3</h2><div id="mat-3"></div></div>
    <div class="mat-card"><h2>Mat 4</h2><div id="mat-4"></div></div>
  </div>
</div>

<script>
//////////////////////////////////////////////////////////////////////////////
// FIREBASE INIT
//////////////////////////////////////////////////////////////////////////////

const firebaseConfig = {
  apiKey: "AIzaSyD_uk47fURmQiHZnN8avfcGoNObMntdu_s",
  authDomain: "matsidewrestlingco-fb85f.firebaseapp.com",
  projectId: "matsidewrestlingco-fb85f",
  storageBucket: "matsidewrestlingco-fb85f.firebasestorage.app",
  messagingSenderId: "898197416726",
  appId: "1:898197416726:web:921ccbd0f63f7fd6537e37"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

//////////////////////////////////////////////////////////////////////////////
// LISTENER — ALL MATS, LIVE UPDATES
//////////////////////////////////////////////////////////////////////////////

db.collection("matchLibrary").onSnapshot(snapshot => {
  const matches = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

  const mats = { 1: [], 2: [], 3: [], 4: [] };

  matches.forEach(m => {
    const matNum = Number(m.assignedMat);
    if (matNum >= 1 && matNum <= 4) {
      mats[matNum].push(m);
    }
  });

  // Sort by queue order
  for (let m = 1; m <= 4; m++) {
    mats[m].sort((a, b) => {
      const qa = a.queueIndex ?? 9999;
      const qb = b.queueIndex ?? 9999;
      return qa - qb;
    });
  }

  // Render each mat
  for (let m = 1; m <= 4; m++) {
    renderMat(m, mats[m]);
  }
});

//////////////////////////////////////////////////////////////////////////////
// RENDER FUNCTION WITH TIERS
//////////////////////////////////////////////////////////////////////////////

function renderMat(matNum, list) {
  const container = document.getElementById(`mat-${matNum}`);
  container.innerHTML = "";

  if (!list.length) {
    container.innerHTML = `<div class="empty-text">No upcoming matches</div>`;
    return;
  }

  // Tiers
  const now = list[0] || null;
  const onDeck = list[1] || null;
  const inHole = list[2] || null;
  const upcoming = list.slice(3);

  // NOW WRESTLING
  container.innerHTML += `<div class="tier-title">Now Wrestling</div>`;
  if (now) container.appendChild(makeMatchItem(now, "now-wrestling"));
  else container.innerHTML += `<div class="empty-text">— No match —</div>`;

  // ON DECK
  container.innerHTML += `<div class="tier-title">On Deck</div>`;
  if (onDeck) container.appendChild(makeMatchItem(onDeck, "on-deck"));
  else container.innerHTML += `<div class="empty-text">— No match —</div>`;

  // IN THE HOLE
  container.innerHTML += `<div class="tier-title">In The Hole</div>`;
  if (inHole) container.appendChild(makeMatchItem(inHole, "in-hole"));
  else container.innerHTML += `<div class="empty-text">— No match —</div>`;

  // UPCOMING LIST
  container.innerHTML += `<div class="tier-title">Upcoming</div>`;
  if (!upcoming.length) {
    container.innerHTML += `<div class="empty-text">— None —</div>`;
  } else {
    upcoming.forEach(m => container.appendChild(makeMatchItem(m)));
  }
}

//////////////////////////////////////////////////////////////////////////////
// MATCH CARD UI
//////////////////////////////////////////////////////////////////////////////

function makeMatchItem(match, extraClass = "") {
  const div = document.createElement("div");
  div.className = `match-item ${extraClass}`;

  div.innerHTML = `
    <div><strong>Bout ${match.bout}</strong> — ${match.weight || "?"} lbs</div>
    <div>${match.red.name || "Red"} (${match.red.team || ""}) vs ${match.green.name || "Green"} (${match.green.team || ""})</div>
    <div class="match-meta">Round: ${match.round || "-"}</div>
  `;

  return div;
}
</script>

</body>
</html>
