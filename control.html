<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Matside — Control Panel v3.0</title>

<!-- Socket.io -->
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

<!-- Base Skin Variables -->
<style>
  :root {
    --ms-bg:#080808;
    --ms-text:#ffffff;
    --ms-muted:#9aa0a6;
    --ms-panel:#111214;
    --ms-card:#15161a;
    --ms-accent:#1e88e5;
    --ms-red:#d32f2f;
    --ms-green:#388e3c;
    --ms-gold:#fbc02d;
  }
  body {
    margin:0;
    background:var(--ms-bg);
    color:var(--ms-text);
    font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial;
  }

  /* HEADER */
  .header-bar {
    background:var(--ms-bg);
    border-bottom:1px solid #111;
  }
  .header-inner {
    max-width:1100px;
    margin:0 auto;
    padding:6px 14px;
    display:flex;
    align-items:center;
    gap:10px;
  }
  .brand-logo { height:40px; border-radius:8px; }

  .wrap { max-width:1100px; margin:0 auto; padding:14px; }

  /* SUMMARY BAR */
  .summary {
    margin-top:10px;
    padding:10px 12px;
    background:var(--ms-card);
    border-radius:10px;
    display:flex;
    justify-content:space-between;
    flex-wrap:wrap;
    font-size:14px;
  }
  .summary strong { font-weight:800; }
  .redText { color:var(--ms-red); }
  .greenText { color:var(--ms-green); }

  /* BUTTONS */
  button {
    border:0;
    border-radius:10px;
    padding:10px 14px;
    font-size:15px;
    font-weight:700;
    cursor:pointer;
  }
  .blue { background:var(--ms-accent); color:var(--ms-text); }
  .gray { background:var(--ms-card); color:var(--ms-text); }
  .red { background:var(--ms-red); color:var(--ms-text); }
  .green { background:var(--ms-green); color:var(--ms-text); }
  .gold { background:var(--ms-gold); color:black; }
  .small { padding:8px 10px; font-size:13px; }

  .grid {
    display:grid;
    grid-template-columns:2fr 3fr;
    gap:14px;
    margin-top:14px;
  }
  @media(max-width:800px){ .grid { grid-template-columns:1fr; } }

  .card {
    background:var(--ms-panel);
    padding:14px;
    border-radius:12px;
    box-shadow:0 4px 12px rgba(0,0,0,.5);
  }
  .card h3 { margin:0 0 10px 0; font-size:16px; }

  .row { display:flex; gap:8px; flex-wrap:wrap; }

  /* DRAWERS */
  .drawer-backdrop {
    position:fixed; inset:0;
    background:rgba(0,0,0,.5);
    opacity:0; pointer-events:none;
    transition:opacity .2s;
    z-index:9998;
  }
  .drawer-backdrop.open { opacity:1; pointer-events:auto; }

  .drawer {
    position:fixed;
    top:0; bottom:0;
    width:300px;
    max-width:85vw;
    background:var(--ms-panel);
    border-right:1px solid #222;
    transform:translateX(-100%);
    transition:.25s transform;
    z-index:9999;
    display:flex;
    flex-direction:column;
  }
  .drawer.open { transform:translateX(0); }

  #drawerRight {
    right:0; left:auto;
    border-right:0;
    border-left:1px solid #222;
    transform:translateX(100%);
  }
  #drawerRight.open { transform:translateX(0); }

  .drawer-header {
    padding:12px;
    border-bottom:1px solid #222;
    font-weight:700;
  }
  .drawer-body {
    padding:12px;
    overflow-y:auto;
    flex:1;
    font-size:14px;
  }

  /* TIMELINE */
  .timeline-item {
    background:var(--ms-card);
    border-left:4px solid var(--ms-accent);
    padding:8px;
    margin-bottom:8px;
    border-radius:6px;
  }
  .timeline-item small { color:var(--ms-muted); display:block; }

  /* END MATCH MODAL */
  #matchModal {
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.7);
    display:none;
    align-items:center;
    justify-content:center;
    z-index:99999;
  }
  #matchModal.active { display:flex; }
  .modal-card {
    background:var(--ms-panel);
    padding:20px;
    border-radius:14px;
    width:340px;
  }

  /* LAST MATCH TOAST */
  #lastMatchToast {
    position:fixed;
    bottom:12px;
    left:50%;
    transform:translateX(-50%);
    padding:12px 18px;
    background:var(--ms-panel);
    border-radius:10px;
    border:1px solid var(--ms-accent);
    display:none;
    z-index:99990;
  }
</style>
</head>

<body>

<!-- HEADER -->
<div class="header-bar">
  <div class="header-inner">
    <img src="https://www.matside.org/assets/images/image01.png" class="brand-logo" />
    <div style="font-size:18px;font-weight:700;">Matside Control Panel</div>
  </div>
</div>

<div class="wrap">

  <!-- CONTROL BAR -->
  <div style="display:flex;align-items:center;justify-content:space-between;">
    <button class="gray" id="openLeft">⚡</button>

    <div style="display:flex;align-items:center;gap:10px;">
      <label>Mat</label>
      <select id="matSelect">
        <option value="1">Mat 1</option>
        <option value="2">Mat 2</option>
        <option value="3">Mat 3</option>
        <option value="4">Mat 4</option>
      </select>

      <div style="font-size:13px;color:var(--ms-muted);">
        Status: <span id="conn">connecting…</span>
      </div>
    </div>

    <button class="gray" id="openRight">⚙️</button>
  </div>

  <!-- SUMMARY -->
  <div class="summary">
    <div>Mat: <strong id="sumMat">1</strong></div>
    <div>Period: <strong id="sumPeriod">1</strong></div>
    <div>Time: <strong id="sumTime">01:00</strong></div>
    <div>Red: <strong class="redText" id="sumRed">0</strong></div>
    <div>Green: <strong class="greenText" id="sumGreen">0</strong></div>
  </div>

  <!-- GRID -->
  <div class="grid">

    <!-- TIMER CARD -->
    <div class="card">
      <h3>Timer</h3>
      <div class="row">
        <button id="startBtn" class="blue">Start</button>
        <button id="stopBtn" class="gray">Stop</button>
        <button id="endMatchBtn" class="red">End Match</button>
      </div>

      <div class="row" style="margin-top:8px;">
        <button id="resetTimerBtn" class="gold">Reset Timer</button>
      </div>
    </div>

    <!-- SCORING -->
    <div class="card">
      <h3>Scoring</h3>

      <div class="row">
        <!-- Red -->
        <div style="flex:1;">
          <div style="font-size:13px;color:var(--ms-muted);margin-bottom:4px;">
            Red Wrestler
          </div>
          <div class="row">
            <button class="red small scoreBtn" data-color="red" data-pts="1">E1</button>
            <button class="red small scoreBtn" data-color="red" data-pts="2">R2</button>
            <button class="red small scoreBtn" data-color="red" data-pts="3">T3</button>
            <button class="red small scoreBtn" data-color="red" data-pts="2">N2</button>
            <button class="red small scoreBtn" data-color="red" data-pts="3">N3</button>
            <button class="red small scoreBtn" data-color="red" data-pts="4">N4</button>
          </div>
        </div>

        <!-- Green -->
        <div style="flex:1;">
          <div style="font-size:13px;color:var(--ms-muted);margin-bottom:4px;">
            Green Wrestler
          </div>
          <div class="row">
            <button class="green small scoreBtn" data-color="green" data-pts="1">E1</button>
            <button class="green small scoreBtn" data-color="green" data-pts="2">R2</button>
            <button class="green small scoreBtn" data-color="green" data-pts="3">T3</button>
            <button class="green small scoreBtn" data-color="green" data-pts="2">N2</button>
            <button class="green small scoreBtn" data-color="green" data-pts="3">N3</button>
            <button class="green small scoreBtn" data-color="green" data-pts="4">N4</button>
          </div>
        </div>
      </div>

      <div class="row" style="margin-top:10px;">
        <button id="subRed" class="gray small">-1 Red</button>
        <button id="resetScores" class="gold small">Reset Scores</button>
        <button id="subGreen" class="gray small">-1 Green</button>
      </div>
    </div>
  </div>
</div>

<!-- LEFT DRAWER -->
<div class="drawer-backdrop" id="leftBackdrop"></div>
<div class="drawer" id="drawerLeft">
  <div class="drawer-header">Timer Settings</div>
  <div class="drawer-body" id="timerDrawerBody"></div>
</div>

<!-- RIGHT DRAWER -->
<div class="drawer-backdrop" id="rightBackdrop"></div>
<div class="drawer" id="drawerRight">
  <div class="drawer-header">Match Settings</div>
  <div class="drawer-body" id="rightDrawerBody"></div>
</div>

<!-- END MATCH MODAL -->
<div id="matchModal">
  <div class="modal-card">
    <div style="font-size:18px;font-weight:700;margin-bottom:10px;">End Match</div>

    <div>Select Winner:</div>
    <div class="row" style="margin:6px 0;">
      <button class="red" id="endRed">Red</button>
      <button class="green" id="endGreen">Green</button>
    </div>

    <div style="margin-top:10px;">Victory Type:</div>
    <div class="row" style="margin:6px 0;">
      <button class="blue" data-victory="decision">Decision</button>
      <button class="blue" data-victory="tech fall">Tech Fall</button>
      <button class="blue" data-victory="pin">Pin</button>
      <button class="blue" data-victory="forfeit">Forfeit</button>
    </div>

    <button id="closeMatchModal" class="gray" style="width:100%;margin-top:10px;">
      Cancel
    </button>
  </div>
</div>

<!-- LAST MATCH TOAST -->
<div id="lastMatchToast"></div>

<!-- MODULES -->
<script type="module">
  import { initSkinClient } from "./modules/ui/skins.js";
  import { initStateSync } from "./modules/state/state-sync.js";
  import { initTimerDrawer } from "./modules/ui/timer-drawer.js";
  import { initRightDrawer } from "./modules/ui/right-drawer.js";
  import { initTimeline } from "./modules/timeline/timeline.js";

  /* SKIN ADAPTER */
  const { getCurrentSkin, onSkinChanged } = initSkinClient(
    "https://scoreboard-server-er33.onrender.com"
  );

  function applySkin(skin) {
    if (!skin?.vars) return;
    for (const [key,val] of Object.entries(skin.vars)) {
      document.documentElement.style.setProperty(key,val);
    }
  }

  // initial skin
  getCurrentSkin().then(applySkin);
  onSkinChanged(applySkin);

  /* SOCKET + STATE SYNC */
  const { socket, updateUI, endMatchFlow } = initStateSync();

  /* Inject drawers */
  initTimerDrawer();
  initRightDrawer();

  /* Timeline */
  initTimeline();

  /* Drawer open/close */
  const openLeft = document.getElementById("openLeft");
  const openRight = document.getElementById("openRight");
  const drawerLeft = document.getElementById("drawerLeft");
  const drawerRight = document.getElementById("drawerRight");
  const leftBackdrop = document.getElementById("leftBackdrop");
  const rightBackdrop = document.getElementById("rightBackdrop");

  openLeft.onclick = () => {
    drawerLeft.classList.add("open");
    leftBackdrop.classList.add("open");
  };
  leftBackdrop.onclick = () => {
    drawerLeft.classList.remove("open");
    leftBackdrop.classList.remove("open");
  };

  openRight.onclick = () => {
    drawerRight.classList.add("open");
    rightBackdrop.classList.add("open");
  };
  rightBackdrop.onclick = () => {
    drawerRight.classList.remove("open");
    rightBackdrop.classList.remove("open");
  };
</script>

</body>
</html>
