<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Matside — Control Panel v3.2</title>

<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

<style>
/* ============================================================
   GLOBAL THEME — Matches Scoreboard v3.2
   ============================================================ */
:root {
  --bg: #070809;
  --panel: rgba(22,24,28,0.8);
  --border: rgba(255,255,255,0.08);

  --accent: #1e88e5;

  --red-glow: #ff4444;
  --red-back: #1a0000;

  --green-glow: #66ff66;
  --green-back: #001a00;

  --radius: 20px;
}

html,body {
  margin: 0;
  background: var(--bg);
  color: white;
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial;
}

/* ============================================================
   HEADER
   ============================================================ */
.header {
  padding: 12px 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.header img {
  height: 36px;
  border-radius: 8px;
}
.header .brand {
  font-size: 20px;
  font-weight: 800;
}

/* ============================================================
   TOP SUMMARY BAR (Matches Scoreboard top row)
   ============================================================ */
.summary-bar {
  max-width: 1100px;
  margin: 0 auto;
  margin-top: 10px;
  display: grid;
  grid-template-columns: 1fr 1.4fr 1fr;
  gap: 18px;
}

.summary-box {
  background: rgba(255,255,255,0.06);
  border-radius: var(--radius);
  padding: 14px 0;
  text-align: center;
  font-size: 22px;
  font-weight: 800;
  border: 1px solid var(--border);
}

.summary-time {
  font-size: 42px;
}

/* ============================================================
   MAIN TWIN-PANEL LAYOUT
   ============================================================ */
.main {
  max-width: 1100px;
  margin: 25px auto;
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 18px;
}

.card {
  background: var(--panel);
  border-radius: var(--radius);
  padding: 18px;
  border: 1px solid var(--border);
  box-shadow: 0 8px 24px rgba(0,0,0,0.35);
  backdrop-filter: blur(10px);
}

.card h3 {
  font-size: 22px;
  font-weight: 800;
  margin: 0 0 14px 0;
}

/* ============================================================
   BUTTONS
   ============================================================ */
button {
  border: 0;
  padding: 14px 20px;
  border-radius: 14px;
  font-size: 18px;
  font-weight: 800;
  cursor: pointer;
}

.btn-blue { background: var(--accent); color: white; }
.btn-gray { background: #2a2b2c; color: white; }
.btn-gold { background: #fbc02d; color: black; }

.btn-red {
  background: var(--red-back);
  border: 2px solid var(--red-glow);
  color: white;
}
.btn-green {
  background: var(--green-back);
  border: 2px solid var(--green-glow);
  color: white;
}

.row { display: flex; flex-wrap: wrap; gap: 10px; }

/* ============================================================
   SCORING GRID
   ============================================================ */
.score-columns {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 14px;
}
.scoring-grid {
  display: grid;
  grid-template-columns: repeat(3,1fr);
  gap: 10px;
}

@media(max-width: 700px){
  .main { grid-template-columns: 1fr; }
}

/* ============================================================
   DRAWERS (Restored)
   ============================================================ */
.drawer-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.45);
  opacity: 0;
  pointer-events: none;
  transition: 0.2s ease;
  z-index: 9998;
}
.drawer-backdrop.open {
  opacity: 1;
  pointer-events: auto;
}

.drawer-panel {
  position: fixed;
  top: 0;
  width: 340px;
  max-width: 90vw;
  height: 100%;
  background: var(--panel);
  border-left: 1px solid var(--border);
  border-right: 1px solid var(--border);
  backdrop-filter: blur(12px);
  transform: translateX(100%);
  transition: 0.28s ease;
  z-index: 9999;
  display: flex;
  flex-direction: column;
}
.drawer-panel.open {
  transform: translateX(0);
}

.drawer-header {
  padding: 16px;
  border-bottom: 1px solid var(--border);
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.drawer-title {
  font-size: 20px;
  font-weight: 800;
}
.drawer-close-btn {
  background: none;
  border: 0;
  font-size: 24px;
  color: white;
  cursor: pointer;
}

.drawer-body {
  padding: 14px;
  overflow-y: auto;
}

/* TIMELINE */
.timeline-box {
  padding: 12px;
  background: rgba(255,255,255,0.06);
  border-radius: var(--radius);
  border: 1px solid var(--border);
  font-size: 14px;
  margin-top: 10px;
}

/* Confirmation Toast */
.toast {
  position: fixed;
  bottom: 16px;
  right: 16px;
  background: #00c853;
  padding: 14px 20px;
  border-radius: 12px;
  font-weight: 800;
  font-size: 18px;
  opacity: 0;
  transform: translateY(20px);
  transition: 0.25s ease;
}
.toast.show {
  opacity: 1;
  transform: translateY(0);
}

/* Submission Banner */
.submission-banner {
  margin-top: 16px;
  padding: 14px;
  background: rgba(255,255,255,0.06);
  border-radius: 12px;
  border: 1px solid var(--border);
  font-weight: 700;
  display: none;
}
</style>
</head>
<body>

<!-- ============================================================
     HEADER
     ============================================================ -->
<div class="header">
  <div class="brand">
    <img src="https://www.matside.org/assets/images/image01.png">
    Matside Control
  </div>

  <div>
    Status: <span id="conn">connecting…</span>
  </div>
</div>

<!-- ============================================================
     SUMMARY ROW (Matches Scoreboard v3.2)
     ============================================================ -->
<div class="summary-bar">
  <div class="summary-box">MAT <span id="sumMat">1</span></div>
  <div class="summary-box summary-time" id="sumTime">00:00</div>
  <div class="summary-box">PERIOD <span id="sumPeriod">1</span></div>
</div>

<!-- SUBMISSION BANNER -->
<div id="submissionBanner" class="submission-banner"></div>

<!-- ============================================================
     MAIN TWIN-PANEL LAYOUT
     ============================================================ -->
<div class="main">

  <!-- LEFT: TIMER -->
  <div class="card">
    <h3>Timer</h3>

    <div class="row">
      <button id="startBtn" class="btn-blue">Start</button>
      <button id="stopBtn" class="btn-gray">Stop</button>
      <button id="endMatchBtn" class="btn-gold">End Match</button>
    </div>

    <div class="row" style="margin-top:12px;">
      <button id="resetTimerBtn" class="btn-gold">Reset Timer</button>
    </div>
  </div>

  <!-- RIGHT: SCORING -->
  <div class="card">
    <h3>Scoring</h3>

    <div class="score-columns">

      <!-- RED -->
      <div>
        <div style="color: var(--red-glow); font-size:18px; font-weight:800;">RED</div>
        <div class="scoring-grid">
          <button class="btn-red" data-color="red" data-pts="1">E1</button>
          <button class="btn-red" data-color="red" data-pts="2">R2</button>
          <button class="btn-red" data-color="red" data-pts="3">T3</button>
          <button class="btn-red" data-color="red" data-pts="2">N2</button>
          <button class="btn-red" data-color="red" data-pts="3">N3</button>
          <button class="btn-red" data-color="red" data-pts="4">N4</button>
        </div>
      </div>

      <!-- GREEN -->
      <div>
        <div style="color: var(--green-glow); font-size:18px; font-weight:800;">GREEN</div>
        <div class="scoring-grid">
          <button class="btn-green" data-color="green" data-pts="1">E1</button>
          <button class="btn-green" data-color="green" data-pts="2">R2</button>
          <button class="btn-green" data-color="green" data-pts="3">T3</button>
          <button class="btn-green" data-color="green" data-pts="2">N2</button>
          <button class="btn-green" data-color="green" data-pts="3">N3</button>
          <button class="btn-green" data-color="green" data-pts="4">N4</button>
        </div>
      </div>

    </div>

    <div class="row" style="margin-top:14px;">
      <button id="subRed" class="btn-gray">-1 Red</button>
      <button id="resetScores" class="btn-gold">Reset Scores</button>
      <button id="subGreen" class="btn-gray">-1 Green</button>
    </div>

  </div>
</div>

<!-- ============================================================
     DRAWERS (Left = Timer Settings, Right = Names/Reset/Timeline)
     ============================================================ -->

<!-- TIMER SETTINGS DRAWER -->
<div class="drawer-backdrop" id="leftBackdrop"></div>
<div class="drawer-panel" id="leftDrawer" style="left:0; transform:translateX(-100%);">
  <div class="drawer-header">
    <div class="drawer-title">Timer Settings</div>
    <button class="drawer-close-btn" id="closeLeft">✕</button>
  </div>

  <div class="drawer-body">
    <h4>Period Presets</h4>
    <button class="btn-gray" onclick="applyPreset(60)">1:00</button>
    <button class="btn-gray" onclick="applyPreset(90)">1:30</button>
    <button class="btn-gray" onclick="applyPreset(120)">2:00</button>

    <h4 style="margin-top:20px;">Custom Time</h4>
    <input id="customTime" type="number" placeholder="Seconds" style="width:100%; padding:10px; border-radius:10px; background:#0d0f12; color:white; border:1px solid var(--border);">
    <button onclick="setCustomTime()" class="btn-blue" style="margin-top:10px;">Apply</button>
  </div>
</div>

<!-- RIGHT DRAWER -->
<div class="drawer-backdrop" id="rightBackdrop"></div>
<div class="drawer-panel" id="rightDrawer" style="right:0;">
  <div class="drawer-header">
    <div class="drawer-title">Match Settings</div>
    <button class="drawer-close-btn" id="closeRight">✕</button>
  </div>

  <div class="drawer-body">
    <h4>Wrestlers</h4>
    <div style="margin-bottom:10px;">
      <label>Red Name</label>
      <input id="redNameInput" type="text" placeholder="Red wrestler" style="width:100%; padding:10px; background:#0d0f12; color:white; border-radius:10px; border:1px solid var(--border);">
    </div>

    <div>
      <label>Green Name</label>
      <input id="greenNameInput" type="text" placeholder="Green wrestler" style="width:100%; padding:10px; background:#0d0f12; color:white; border-radius:10px; border:1px solid var(--border);">
    </div>

    <h4 style="margin-top:20px;">Reset Mat</h4>
    <button id="resetMatBtn" class="btn-gold">Reset Entire Mat</button>

    <h4 style="margin-top:20px;">Timeline</h4>
    <div id="timeline" class="timeline-box">No actions yet.</div>
  </div>
</div>

<!-- OPEN DRAWER BUTTONS -->
<div style="position:fixed;left:20px;bottom:20px;">
  <button id="openLeft" class="btn-blue">⚡ Timer</button>
</div>
<div style="position:fixed;right:20px;bottom:20px;">
  <button id="openRight" class="btn-blue">⚙️ Settings</button>
</div>

<!-- TOAST -->
<div id="toast" class="toast"></div>

<!-- ============================================================
     JAVASCRIPT LOGIC
     ============================================================ -->

<script>
/* SOCKET SETUP */
const socket = io("https://scoreboard-server-er33.onrender.com");

socket.on("connect", () => { document.getElementById("conn").textContent = "connected"; });
socket.on("disconnect", () => { document.getElementById("conn").textContent = "disconnected"; });

socket.on("stateUpdate", (state) => {
  const mat = getMat();
  const m = state.mats[mat];
  if (!m) return;

  // Update summary
  document.getElementById("sumMat").textContent = mat;
  document.getElementById("sumTime").textContent = formatTime(m.time);
  document.getElementById("sumPeriod").textContent = m.period;

  // Names
  document.getElementById("redNameInput").value = m.redName || "";
  document.getElementById("greenNameInput").value = m.greenName || "";

  // Timeline
  updateTimeline(m.timeline);
});

/* HELPERS */
function getMat(){ return 1; } // if mat selector is added later
function formatTime(sec){
  const m=Math.floor(sec/60).toString().padStart(2,"0");
  const s=(sec%60).toString().padStart(2,"0");
  return m+":"+s;
}

/* DRAWER CONTROLS */
const leftDrawer = document.getElementById("leftDrawer");
const rightDrawer = document.getElementById("rightDrawer");
const leftBackdrop = document.getElementById("leftBackdrop");
const rightBackdrop = document.getElementById("rightBackdrop");

document.getElementById("openLeft").onclick = () => {
  leftDrawer.classList.add("open");
  leftBackdrop.classList.add("open");
};
document.getElementById("openRight").onclick = () => {
  rightDrawer.classList.add("open");
  rightBackdrop.classList.add("open");
};
document.getElementById("closeLeft").onclick = () => {
  leftDrawer.classList.remove("open");
  leftBackdrop.classList.remove("open");
};
document.getElementById("closeRight").onclick = () => {
  rightDrawer.classList.remove("open");
  rightBackdrop.classList.remove("open");
};
leftBackdrop.onclick = () => { leftDrawer.classList.remove("open"); leftBackdrop.classList.remove("open"); };
rightBackdrop.onclick = () => { rightDrawer.classList.remove("open"); rightBackdrop.classList.remove("open"); };

/* TIMER CONTROLS */
document.getElementById("startBtn").onclick = () => socket.emit("updateState", {mat:getMat(), updates:{running:true}});
document.getElementById("stopBtn").onclick  = () => socket.emit("updateState", {mat:getMat(), updates:{running:false}});
document.getElementById("resetTimerBtn").onclick = () => socket.emit("updateState", {mat:getMat(), updates:{time:0,running:false}});

/* SCORING */
document.querySelectorAll(".scoring-grid button").forEach(btn=>{
  btn.onclick = ()=>{
    socket.emit("addPoints", {mat:getMat(), color:btn.dataset.color, pts:+btn.dataset.pts});
  };
});
document.getElementById("subRed").onclick   = () => socket.emit("subPoint",{mat:getMat(),color:"red"});
document.getElementById("subGreen").onclick = () => socket.emit("subPoint",{mat:getMat(),color:"green"});
document.getElementById("resetScores").onclick = () => socket.emit("updateState",{mat:getMat(),updates:{red:0,green:0}});

/* PRESETS */
function applyPreset(sec){
  socket.emit("updateState", {mat:getMat(), updates:{time:sec}});
}
function setCustomTime(){
  const sec = +document.getElementById("customTime").value;
  if(sec>0) socket.emit("updateState",{mat:getMat(),updates:{time:sec}});
}

/* NAMES */
document.getElementById("redNameInput").onchange = () =>
  socket.emit("updateState",{mat:getMat(),updates:{redName:redNameInput.value}});
document.getElementById("greenNameInput").onchange = () =>
  socket.emit("updateState",{mat:getMat(),updates:{greenName:greenNameInput.value}});

/* RESET MAT */
document.getElementById("resetMatBtn").onclick = () => {
  socket.emit("resetMat",{mat:getMat()});
  showToast("Mat Reset");
};

/* END MATCH */
document.getElementById("endMatchBtn").onclick = () => {
  socket.emit("endMatch",{mat:getMat()});
  showToast("Match Submitted");
  showSubmissionBanner();
};

/* TIMELINE */
function updateTimeline(list){
  const box = document.getElementById("timeline");
  if(!list || list.length===0){
    box.textContent = "No actions yet.";
    return;
  }
  box.innerHTML = list.map(e=>`<div>${e}</div>`).join("");
}

/* TOAST */
function showToast(msg){
  const t=document.getElementById("toast");
  t.textContent=msg;
  t.classList.add("show");
  setTimeout(()=>t.classList.remove("show"),2000);
}

/* SUBMISSION BANNER */
function showSubmissionBanner(){
  const box = document.getElementById("submissionBanner");
  box.style.display = "block";
  box.textContent = "Match Submitted Successfully";
  setTimeout(()=> box.style.display="none", 5000);
}
</script>

</body>
</html>
