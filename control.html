<!-- ===========================================
 control.html  (v2.20 — modular + OT engine)
 Place this at: /control.html in your frontend repo
=========================================== -->
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Matside — Control Panel (v2.20.1)</title>

<!-- Socket.io -->
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

<style>
  :root{
    --bg:#070809; --panel:#15161a; --muted:#9aa0a6;
    --accent:#1e88e5; --red:#d32f2f; --green:#388e3c; --gold:#fbc02d;
    --radius:12px; --gap:12px;
  }
  html,body{
    margin:0;padding:0;
    background:var(--bg);color:#fff;
    font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial;
  }
  .header-bar{
    background:#070809;
    border-bottom:1px solid #111215;
  }
  .header-inner{
    max-width:1100px;
    margin:0 auto;
    padding:4px 14px;
    display:flex;
    align-items:center;
    gap:10px;
  }
  .brand-logo{height:42px;border-radius:8px;}
  .brand-title{font-size:18px;font-weight:700;}
  .header-accent{
    height:2px;
    background:linear-gradient(90deg,
      rgba(30,136,229,0.12),
      rgba(30,136,229,0.5),
      rgba(30,136,229,0.12)
    );
  }
  .wrap{max-width:1100px;margin:0 auto;padding:14px;}
  select{
    padding:8px 10px;border-radius:8px;border:0;
    background:#0e1012;color:#fff;
  }
  .icon-btn{
    height:38px;width:38px;
    border-radius:50%;
    border:2px solid #2f3135;
    background:transparent;color:#fff;
    display:flex;align-items:center;justify-content:center;
    cursor:pointer;font-size:18px;
  }
  .icon-btn:hover{
    background:#0f1115;
    border-color:#4a4d52;
  }
  .status{color:var(--muted);font-size:13px;}

  .summary{
    margin-top:8px;
    padding:8px 10px;
    border-radius:10px;
    display:flex;
    flex-wrap:wrap;
    justify-content:space-between;
    background:linear-gradient(135deg,#15171c,#101216);
  }
  .summary strong{font-weight:800;}
  .redText{color:var(--red);}
  .greenText{color:var(--green);}

  @keyframes timerPulse {
    0% { opacity:1; } 50% { opacity:0.55; } 100% { opacity:1; }
  }
  .timer-running { animation:timerPulse 1.2s infinite ease-in-out; }

  .grid{
    display:grid;
    grid-template-columns:2fr 3fr;
    gap:var(--gap);
    margin-top:12px;
  }
  @media(max-width:900px){ .grid{grid-template-columns:1fr;} }

  .card{
    background:var(--panel);
    border-radius:var(--radius);
    padding:12px;
    box-shadow:0 6px 18px rgba(0,0,0,.6);
  }
  .card h3{margin:0 0 8px;font-size:15px;}

  button{
    border:0;border-radius:10px;
    padding:10px 12px;
    font-weight:700;
    cursor:pointer;
    font-size:15px;
  }
  .small{padding:8px 10px;font-size:13px;}
  .btn-wide{min-width:120px;}
  .blue{background:var(--accent);color:#fff;}
  .gray{background:#2a2b2c;color:#fff;}
  .red{background:var(--red);color:#fff;}
  .green{background:var(--green);color:#fff;}
  .gold{background:var(--gold);color:#000;}
  .row{display:flex;gap:8px;flex-wrap:wrap;}

  .score-columns{
    display:grid;grid-template-columns:1fr 1fr;gap:10px;
  }
  @media(max-width:600px){ .score-columns{grid-template-columns:1fr;} }

  .scoring-grid{
    display:grid;grid-template-columns:repeat(3,1fr);gap:8px;
  }
  @media(max-width:450px){ .scoring-grid{grid-template-columns:repeat(2,1fr);} }

  /* DRAWERS */
  .drawer-backdrop{
    position:fixed;inset:0;
    background:rgba(0,0,0,0.55);
    opacity:0;pointer-events:none;
    transition:opacity .2s;
    z-index:900;
  }
  .drawer-backdrop.open{
    opacity:1;pointer-events:auto;
  }

  .drawer-panel{
    position:fixed;top:0;height:100%;width:320px;
    max-width:100vw;background:#101116;
    border-left:1px solid #202127;
    box-shadow:-10px 0 28px rgba(0,0,0,0.7);
    transform:translateX(100%);
    transition:transform .25s ease-out;
    z-index:901;
    display:flex;flex-direction:column;
  }
  #drawerLeft{left:0;border-left:none;border-right:1px solid #202127;transform:translateX(-100%);box-shadow:10px 0 28px rgba(0,0,0,0.7);}
  #drawerLeft.open{transform:translateX(0);}
  #drawerRight.open{transform:translateX(0);}

  .drawer-header{
    padding:12px 14px;
    border-bottom:1px solid #202127;
    display:flex;justify-content:space-between;align-items:center;
  }
  .drawer-title{font-size:14px;font-weight:700;}
  .drawer-close-btn{
    border:0;background:transparent;color:#fff;
    font-size:18px;cursor:pointer;
  }
  .drawer-body{
    padding:12px 14px 16px;
    font-size:13px;
    overflow-y:auto;
  }
  .drawer-section{margin-bottom:18px;}
  .drawer-section h4{
    margin:0 0 6px;
    font-size:12px;
    text-transform:uppercase;
    color:var(--muted);
  }
  .drawer-note{
    font-size:11px;
    color:var(--muted);
    margin-top:4px;
  }
  .field-row{display:flex;gap:8px;}
  .field-row > div{flex:1;}

  input[type=text],input[type=number],select.drawer-input{
    width:100%;padding:8px 9px;border-radius:8px;
    border:0;background:#0d0e11;color:#fff;
    font-size:13px;
  }

  .timeline-list{
    max-height:220px;
    overflow-y:auto;
    background:#0b0c0f;
    border-radius:8px;
    padding:8px;
    font-size:12px;
  }
  .timeline-item{
    padding:6px 8px;
    border-radius:6px;
    border:1px solid rgba(255,255,255,0.05);
    margin-bottom:6px;
  }
  .timeline-item-header{
    display:flex;
    justify-content:space-between;
    font-size:11px;
    color:var(--muted);
    margin-bottom:2px;
  }
  .timeline-item-body{
    font-size:12px;
  }

  /* END MATCH OVERLAY */
  .endmatch-backdrop{
    position:fixed;inset:0;
    background:rgba(0,0,0,0.7);
    display:none;
    align-items:center;
    justify-content:center;
    z-index:950;
  }
  .endmatch-backdrop.show{display:flex;}
  .endmatch-card{
    background:#111217;
    border-radius:16px;
    border:1px solid rgba(255,255,255,0.08);
    padding:16px 18px 14px;
    max-width:360px;width:90%;
    box-shadow:0 16px 40px rgba(0,0,0,0.8);
  }
  .endmatch-card h3{
    margin:0 0 10px;
    font-size:16px;
  }
  .pill-row{
    display:flex;
    flex-wrap:wrap;
    gap:8px;
    margin:8px 0;
  }
  .pill-btn{
    border-radius:999px;
    border:1px solid rgba(255,255,255,0.1);
    background:#181a1f;
    color:#fff;
    font-size:12px;
    padding:6px 10px;
    cursor:pointer;
  }
  .pill-btn.selected{
    border-color:var(--accent);
    box-shadow:0 0 10px rgba(30,136,229,0.6);
  }

  /* TOAST */
  .toast{
    position:fixed;
    bottom:10px;left:50%;
    transform:translateX(-50%);
    background:#111217;
    border-radius:999px;
    border:1px solid rgba(255,255,255,0.1);
    padding:6px 14px;
    font-size:12px;
    display:none;
    align-items:center;
    gap:6px;
    z-index:999;
  }
  .toast.show{display:inline-flex;}
  .toast-ok{color:#a5d6a7;}
  .toast-err{color:#ef9a9a;}

  /* VERSION */
  #version-tag{
    position:fixed;
    bottom:6px;
    right:10px;
    font-size:11px;
    color:#666;
    opacity:0.75;
    pointer-events:none;
    user-select:none;
    font-weight:600;
    z-index:99999;
  }
</style>
</head>
<body>

<!-- HEADER -->
<div class="header-bar">
  <div class="header-inner">
    <img src="https://www.matside.org/assets/images/image01.png" class="brand-logo" alt="Matside"/>
    <div class="brand-title">Matside</div>
  </div>
  <div class="header-accent"></div>
</div>

<div class="wrap">

  <!-- TOP BAR -->
  <div class="top-bar" style="display:flex;justify-content:space-between;align-items:center;">
    <button id="openDrawerLeft" class="icon-btn" title="Timer Settings">⚡</button>

    <div style="display:flex;align-items:center;gap:10px;">
      <label>Mat</label>
      <select id="matSelect">
        <option value="1">Mat 1</option>
        <option value="2">Mat 2</option>
        <option value="3">Mat 3</option>
        <option value="4">Mat 4</option>
      </select>
      <div class="status">Status: <span id="conn">connecting…</span></div>
    </div>

    <button id="openDrawerRight" class="icon-btn" title="Match Settings & Timeline">⚙️</button>
  </div>

  <!-- SUMMARY BAR -->
  <div class="summary">
    <div>Mat: <strong id="sumMat">1</strong></div>
    <div>Period: <strong id="sumPeriod">1</strong></div>
    <div>Time: <strong id="sumTime">00:00</strong></div>
    <div>Red: <strong id="sumRed" class="redText">0</strong></div>
    <div>Green: <strong id="sumGreen" class="greenText">0</strong></div>
  </div>

  <!-- MAIN GRID -->
  <div class="grid">

    <!-- TIMER CARD -->
    <div class="card">
      <h3>Timer</h3>
      <div class="row">
        <button id="startBtn" class="blue btn-wide">Start</button>
        <button id="stopBtn" class="gray btn-wide">Stop</button>
        <button id="endMatchBtn" class="gold btn-wide">End Match</button>
      </div>
      <div class="row" style="margin-top:6px;">
        <button id="resetTimerBtn" class="gold btn-wide">Reset Timer</button>
      </div>
      <div style="margin-top:8px;color:var(--muted);font-size:13px;">
        Period presets & custom timing live in ⚡ Timer Settings.
      </div>
    </div>

    <!-- SCORING CARD -->
    <div class="card">
      <h3>Scoring</h3>

      <div class="score-columns">
        <!-- RED -->
        <div>
          <div class="status" style="margin-bottom:4px;">Red Wrestler</div>
          <div class="scoring-grid">
            <button class="red small score-btn" data-color="red" data-pts="1">E1 (+1)</button>
            <button class="red small score-btn" data-color="red" data-pts="2">R2 (+2)</button>
            <button class="red small score-btn" data-color="red" data-pts="3">T3 (+3)</button>
            <button class="red small score-btn" data-color="red" data-pts="2">N2 (+2)</button>
            <button class="red small score-btn" data-color="red" data-pts="3">N3 (+3)</button>
            <button class="red small score-btn" data-color="red" data-pts="4">N4 (+4)</button>
          </div>
        </div>
        <!-- GREEN -->
        <div>
          <div class="status" style="margin-bottom:4px;">Green Wrestler</div>
          <div class="scoring-grid">
            <button class="green small score-btn" data-color="green" data-pts="1">E1 (+1)</button>
            <button class="green small score-btn" data-color="green" data-pts="2">R2 (+2)</button>
            <button class="green small score-btn" data-color="green" data-pts="3">T3 (+3)</button>
            <button class="green small score-btn" data-color="green" data-pts="2">N2 (+2)</button>
            <button class="green small score-btn" data-color="green" data-pts="3">N3 (+3)</button>
            <button class="green small score-btn" data-color="green" data-pts="4">N4 (+4)</button>
          </div>
        </div>
      </div>

      <div class="row" style="margin-top:10px;">
        <button id="subRed" class="small gray">-1 Red</button>
        <button id="resetScores" class="small gold">Reset Scores</button>
        <button id="subGreen" class="small gray">-1 Green</button>
      </div>

    </div>

  </div>
</div>

<!-- DRAWERS -->
<div id="backdropLeft" class="drawer-backdrop"></div>
<div id="backdropRight" class="drawer-backdrop"></div>

<div id="drawerLeft" class="drawer-panel">
  <div class="drawer-header">
    <div class="drawer-title">Timer Settings</div>
    <button id="closeDrawerLeft" class="drawer-close-btn">✕</button>
  </div>
  <div class="drawer-body">
    <div class="drawer-section">
      <h4>Regulation Presets</h4>
      <div class="row">
        <button class="small gray preset-btn" data-sec="60">1:00</button>
        <button class="small gray preset-btn" data-sec="90">1:30</button>
        <button class="small gray preset-btn" data-sec="120">2:00</button>
      </div>
      <div class="drawer-note">Sets the regulation period length for this mat.</div>
    </div>

    <div class="drawer-section">
      <h4>Custom Time</h4>
      <div class="field-row">
        <div>
          <label>Seconds</label>
          <input id="customSecondsInput" type="number" min="10" class="drawer-input" placeholder="Ex: 75">
        </div>
      </div>
      <div class="row" style="margin-top:8px;">
        <button id="applyCustomTime" class="small blue">Apply</button>
      </div>
      <div class="drawer-note">Enter total seconds for custom periods or OT segments.</div>
    </div>
  </div>
</div>

<div id="drawerRight" class="drawer-panel">
  <div class="drawer-header">
    <div class="drawer-title">Match Settings & Timeline</div>
    <button id="closeDrawerRight" class="drawer-close-btn">✕</button>
  </div>
  <div class="drawer-body">
    <div class="drawer-section">
      <h4>Wrestler Names</h4>
      <div class="field-row">
        <div>
          <label>Red</label>
          <input id="redNameInput" type="text" class="drawer-input" placeholder="Red wrestler name">
        </div>
        <div>
          <label>Green</label>
          <input id="greenNameInput" type="text" class="drawer-input" placeholder="Green wrestler name">
        </div>
      </div>
      <div class="drawer-note">
        Names are local to this device for now; we can wire them to the display later.
      </div>
    </div>

    <div class="drawer-section">
      <h4>Reset Mat</h4>
      <button id="resetMatBtn" class="small red" style="width:100%;">Reset Entire Mat</button>
      <div class="drawer-note">
        Resets time, segment, scores, names, and clears the timeline for this mat.
      </div>
    </div>

    <div class="drawer-section">
      <h4>Match Timeline</h4>
      <div id="timelineList" class="timeline-list"></div>
    </div>
  </div>
</div>

<!-- END MATCH OVERLAY -->
<div id="endMatchOverlay" class="endmatch-backdrop">
  <div class="endmatch-card">
    <h3>End Match</h3>
    <div style="font-size:13px;color:var(--muted);margin-bottom:6px;">
      Select the winner and result type, then submit.
    </div>

    <div style="font-size:12px;margin-top:4px;">Winner</div>
    <div class="pill-row">
      <button class="pill-btn" data-winner="red">Red</button>
      <button class="pill-btn" data-winner="green">Green</button>
    </div>

    <div style="font-size:12px;margin-top:6px;">Result</div>
    <div class="pill-row">
      <button class="pill-btn" data-result="decision">Decision</button>
      <button class="pill-btn" data-result="tech-fall">Tech Fall</button>
      <button class="pill-btn" data-result="pin">Pin</button>
      <button class="pill-btn" data-result="forfeit">Forfeit</button>
    </div>

    <div class="row" style="margin-top:10px;justify-content:flex-end;">
      <button id="cancelEndMatch" class="small gray">Cancel</button>
      <button id="submitEndMatch" class="small blue">Submit</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div id="toast" class="toast">
  <span id="toastIcon">✔</span>
  <span id="toastText">Saved</span>
</div>

<div id="version-tag">v2.20 modular</div>

<!-- MAIN INIT SCRIPT -->
<script type="module" src="modules/init.js"></script>
</body>
</html>
