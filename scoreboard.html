<!-- scoreboard.html -->
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Matside Scoreboard</title>
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<style>
  body {
    margin: 0;
    background: #000;
    color: #fff;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial;
    text-align: center;
    overflow: hidden;
  }
  #wrap {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
  }
  .top-bar {
    font-size: 32px;
    font-weight: 700;
    display: flex;
    justify-content: space-between;
    padding: 0 10px 20px;
  }
  #timer {
    font-size: 160px;
    font-weight: 900;
    margin: 10px 0 20px;
    line-height: 1;
  }
  @keyframes flash {
    0%   { color: #fff; }
    50%  { color: #ff3333; }
    100% { color: #fff; }
  }
  .flash { animation: flash 1s infinite; }

  .name-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    font-size: 42px;
    font-weight: 800;
    margin-top: 10px;
    margin-bottom: 10px;
  }
  .red-name {
    background: #c62828;
    padding: 18px 8px;
    border-radius: 12px 4px 4px 12px;
  }
  .green-name {
    background: #2e7d32;
    padding: 18px 8px;
    border-radius: 4px 12px 12px 4px;
  }
  .score-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
    margin-top: 16px;
  }
  .score-box {
    font-size: 220px;
    font-weight: 900;
    padding: 40px 0;
    border-radius: 16px;
  }
  .score-red { background: #c62828; }
  .score-green { background: #2e7d32; }

  @keyframes glowRed {
    0% { box-shadow: 0 0 0px #c62828; }
    50% { box-shadow: 0 0 26px #c62828; }
    100% { box-shadow: 0 0 0px #c62828; }
  }
  @keyframes glowGreen {
    0% { box-shadow: 0 0 0px #2e7d32; }
    50% { box-shadow: 0 0 26px #2e7d32; }
    100% { box-shadow: 0 0 0px #2e7d32; }
  }
  .winner-banner {
    margin-top: 26px;
    font-size: 64px;
    font-weight: 900;
    padding: 16px 0;
    border-radius: 12px;
    display: none;
  }
  .winner-red {
    background: #c62828;
    animation: glowRed 1s infinite;
  }
  .winner-green {
    background: #2e7d32;
    animation: glowGreen 1s infinite;
  }

  /* Subtle watermark */
  .brand-watermark {
    position: fixed;
    bottom: 8px;
    left: 10px;
    font-size: 13px;
    color: rgba(255,255,255,0.2);
    letter-spacing: 0.08em;
    text-transform: uppercase;
    pointer-events:none;
    user-select:none;
  }

  /* Version tag smaller on scoreboard */
  #version-tag{
    position:fixed;
    bottom:6px;
    right:10px;
    font-size:10px;
    color:#666;
    opacity:0.7;
    pointer-events:none;
    user-select:none;
    font-weight:600;
    z-index:99999;
  }
</style>
</head>
<body>
<div id="wrap">
  <div class="top-bar">
    <div>MAT <span id="mat-number">1</span></div>
    <div>PERIOD <span id="period-number">1</span></div>
  </div>

  <div id="timer">00:00</div>

  <div class="name-row">
    <div class="red-name" id="red-name">RED WRESTLER</div>
    <div class="green-name" id="green-name">GREEN WRESTLER</div>
  </div>

  <div class="score-row">
    <div class="score-box score-red"><span id="sb-red">0</span></div>
    <div class="score-box score-green"><span id="sb-green">0</span></div>
  </div>

  <div class="winner-banner" id="winner-banner"></div>
</div>

<div class="brand-watermark">Matside</div>

<script>
const params = new URLSearchParams(window.location.search);
const mat = Number(params.get("mat")) || 1;
document.getElementById("mat-number").textContent = mat;

const SERVER = "https://scoreboard-server-er33.onrender.com";
const socket = io(SERVER, { transports:["websocket"] });

function fmt(sec){
  sec = Number(sec) || 0;
  const m = Math.floor(sec / 60);
  const s = sec % 60;
  return (m<10?"0":"") + m + ":" + (s<10?"0":"") + s;
}

const periodEl = document.getElementById("period-number");
const timerEl  = document.getElementById("timer");
const redNameEl   = document.getElementById("red-name");
const greenNameEl = document.getElementById("green-name");
const redScoreEl   = document.getElementById("sb-red");
const greenScoreEl = document.getElementById("sb-green");
const winnerBanner = document.getElementById("winner-banner");

socket.on("stateUpdate", state => {
  const m = state?.mats?.[mat];
  if (!m) return;

  winnerBanner.style.display = "none";
  winnerBanner.classList.remove("winner-red","winner-green");

  periodEl.textContent = m.period;
  timerEl.textContent = fmt(m.timeRemaining);
  redScoreEl.textContent = m.player1;
  greenScoreEl.textContent = m.player2;
  redNameEl.textContent = m.redName || "RED WRESTLER";
  greenNameEl.textContent = m.greenName || "GREEN WRESTLER";

  if (m.timeRemaining === 0) {
    timerEl.classList.add("flash");
  } else {
    timerEl.classList.remove("flash");
  }

  if (m.timeRemaining === 0) {
    if (m.player1 > m.player2) {
      winnerBanner.style.display = "block";
      winnerBanner.textContent = "WINNER — RED";
      winnerBanner.classList.add("winner-red");
    } else if (m.player2 > m.player1) {
      winnerBanner.style.display = "block";
      winnerBanner.textContent = "WINNER — GREEN";
      winnerBanner.classList.add("winner-green");
    } else {
      winnerBanner.style.display = "block";
      winnerBanner.textContent = "MATCH OVER";
    }
  }
});
</script>
<script src="version-loader.js"></script>
</body>
</html>
